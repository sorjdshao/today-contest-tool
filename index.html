<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ピーキング戦略（大会当日）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
    .container { background: #fff; padding: 20px; border-radius: 10px; max-width: 900px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 20px; padding: 10px; font-size: 1em; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background-color: #eee; }
    @media print {
      button { display: none; }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>ピーキング戦略（大会当日）</h1>

  <label>体重（kg）</label>
  <input id="weight" type="number" placeholder="例：70" />

  <label>体脂肪率（％）</label>
  <input id="bodyfat" type="number" placeholder="例：10" />

  <label>TDEE（1日の消費カロリー）</label>
  <input id="tdee" type="number" placeholder="例：2400" />

  <label>起床時間</label>
  <input id="wakeTime" type="time" />

  <label>ステージ数</label>
  <select id="stageCount">
    <option value="1">1ステージ</option>
    <option value="2">2ステージ</option>
    <option value="3">3ステージ</option>
  </select>

  <label>ステージ1の時間</label>
  <input id="stageTime1" type="time" />

  <label>ステージ2の時間</label>
  <input id="stageTime2" type="time" />

  <label>ステージ3の時間</label>
  <input id="stageTime3" type="time" />

  <label>パンプアップ開始時間（ステージの◯分前）</label>
  <input id="pumpMinutes" type="number" placeholder="例：30" />

  <label>食事間隔（分）</label>
  <input id="mealInterval" type="number" placeholder="例：120" />

  <label>当日の総摂取カロリー</label>
  <input id="todayCalories" type="number" placeholder="例：2200" />

  <label>水分感受性</label>
  <select id="waterSensitivity">
    <option value="low">低</option>
    <option value="medium" selected>中</option>
    <option value="high">高</option>
  </select>

  <label>塩分感受性</label>
  <select id="saltSensitivity">
    <option value="low">低</option>
    <option value="medium" selected>中</option>
    <option value="high">高</option>
  </select>

  <label>炭水化物の配分戦略</label>
  <select id="carbTiming">
    <option value="even">均等に配分</option>
    <option value="front">前半に多め</option>
    <option value="back" selected>後半に多め</option>
  </select>

  <button onclick="generateCompetitionDayPlan()">当日スケジュールを表示</button>

  <div id="output"></div>
</div>

<script>
function generateCompetitionDayPlan() {
  const weight = parseFloat(document.getElementById("weight").value);
  const bodyfat = parseFloat(document.getElementById("bodyfat").value);
  const tdee = parseFloat(document.getElementById("tdee").value);
  const wakeTime = document.getElementById("wakeTime").value;
  const stageCount = parseInt(document.getElementById("stageCount").value);
  const stageTime1 = document.getElementById("stageTime1").value;
  const stageTime2 = document.getElementById("stageTime2").value;
  const stageTime3 = document.getElementById("stageTime3").value;
  const pumpMinutes = parseInt(document.getElementById("pumpMinutes").value);
  const mealInterval = parseInt(document.getElementById("mealInterval").value);
  const todayCalories = parseInt(document.getElementById("todayCalories").value);
  const waterSensitivity = document.getElementById("waterSensitivity").value;
  const saltSensitivity = document.getElementById("saltSensitivity").value;
  const carbTiming = document.getElementById("carbTiming").value;

  const leanWeight = weight * (1 - bodyfat / 100);
  const baseProtein = Math.round(leanWeight * 2.3);
  const baseFat = 30;
  const proteinKcal = baseProtein * 4;
  const fatKcal = baseFat * 9;
  const carbKcal = todayCalories - proteinKcal - fatKcal;
  const totalCarb = Math.round(carbKcal / 4);

  const mealCount = Math.floor((12 * 60) / mealInterval);
  const pMeal = Math.round(baseProtein / mealCount);
  const fMeal = Math.round(baseFat / mealCount);

  let carbWeights = [];
  for (let i = 0; i < mealCount; i++) {
    if (carbTiming === "even") carbWeights.push(1);
    else if (carbTiming === "front") carbWeights.push(i < mealCount / 2 ? 1.2 : 0.8);
    else carbWeights.push(i < mealCount / 2 ? 0.8 : 1.2);
  }
  const totalWeight = carbWeights.reduce((a, b) => a + b, 0);
  const cMeals = carbWeights.map(w => Math.round((totalCarb * w) / totalWeight));

  const adjust = (val, sens) => {
    const factor = { low: 1.2, medium: 1.0, high: 0.8 };
    return (val * factor[sens]).toFixed(1);
  };
  const water = adjust(Math.max(weight * 0.05, 1.5), waterSensitivity);
  const salt = Math.round(adjust(Math.max(weight * 0.1, 2), saltSensitivity));

  const [wakeH, wakeM] = wakeTime.split(":").map(Number);
  const startTime = new Date(0, 0, 0, wakeH, wakeM);
  const output = document.getElementById("output");
  output.innerHTML = "<h3>大会当日スケジュール</h3>";
  output.innerHTML += `<p>総カロリー: ${todayCalories} kcal / 水分: ${water} L / 塩分: ${salt} g</p>`;
  output.innerHTML += "<table><thead><tr><th>時間</th><th>内容</th><th>P</th><th>F</th><th>C</th></tr></thead><tbody>";

  for (let i = 0; i < mealCount; i++) {
    const timeStr = startTime.toTimeString().slice(0, 5);
    output.innerHTML += `<tr><td>${timeStr}</td><td>食事${i + 1}</td><td>${pMeal}g</td><td>${fMeal}g</td><td>${cMeals[i]}g</td></tr>`;
    startTime.setMinutes(startTime.getMinutes() + mealInterval);
  }

  if (stageTime1) {
    const [sh, sm] = stageTime1.split(":").map(Number);
    const pump1 = new Date(0, 0, 0, sh, sm);
    pump1.setMinutes(pump1.getMinutes() - pumpMinutes);
    output.innerHTML += `<tr><td>${pump1.toTimeString().slice(0, 5)}</td><td>パンプアップ1</td><td>-</td><td>-</td><td>-</td></tr>`;
    output.innerHTML += `<tr><td>${stageTime1}</td><td>ステージ1</td><td>-</td><td>-</td><td>-</td></tr>`;
  }

  if ((stageCount === 2 || stageCount === 3) && stageTime2) {
    const [sh2, sm2] = stageTime2.split(":").map(Number);
    const pump2 = new Date(0, 0, 0, sh2, sm2);
    pump2.setMinutes(pump2.getMinutes() - pumpMinutes);
    output.innerHTML += `<tr><td>${pump2.toTimeString().slice(0, 5)}</td><td>パンプアップ2</td><td>-</td><td>-</td><td>-</td></tr>`;
    output.innerHTML += `<tr><td>${stageTime2}</td><td>ステージ2</td><td>-</td><td>-</td><td>-</td></tr>`;
  }

  if (stageCount === 3 && stageTime3) {
    const [sh3, sm3] = stageTime3.split(":").map(Number);
    const pump3 = new Date(0, 0, 0, sh3, sm3);
    pump3.setMinutes(pump3.getMinutes() - pumpMinutes);
    output.innerHTML += `<tr><td>${pump3.toTimeString().slice(0, 5)}</td><td>パンプアップ3</td><td>-</td><td>-</td><td>-</td></tr>`;
    output.innerHTML += `<tr><td>${stageTime3}</td><td>ステージ3</td><td>-</td><td>-</td><td>-</td></tr>`;
  }

  output.innerHTML += "</tbody></table>";
}
</script>
</body>
</html>